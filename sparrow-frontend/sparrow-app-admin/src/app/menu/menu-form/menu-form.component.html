<mat-card>
  <mat-card-actions>
    <button
      mat-button
      *ngIf="formGroup.enabled"
      (click)="submit()"
      color="primary"
    >
      保存
    </button>
    <button
      mat-button
      *ngIf="formGroup.enabled"
      (click)="formGroup.disable()"
      color="primary"
    >
      取消
    </button>
    <button
      mat-button
      *ngIf="formGroup.disabled"
      (click)="formGroup.enable()"
      color="primary"
    >
      编辑
    </button>
  </mat-card-actions>
  <mat-card-content>
    <form [formGroup]="formGroup">
      <mat-form-field>
        <mat-label>名称</mat-label>
        <input type="text" matInput formControlName="name" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>图标</mat-label>
        <input type="text" matInput formControlName="icon" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>代码</mat-label>
        <input type="text" matInput formControlName="code" />
      </mat-form-field>

      <mat-form-field>
        <mat-label>Link</mat-label>
        <input type="text" matInput formControlName="url" />
      </mat-form-field>

      <mat-radio-group
        formControlName="type"
        [ngClass]="{
          'radio-invalid':
            formGroup.get('type')?.touched && formGroup.get('type')?.invalid
        }"
      >
        <mat-radio-button value="url">URL</mat-radio-button>
        <mat-radio-button value="route">Route</mat-radio-button>
      </mat-radio-group>

      <ng-container *ngIf="formGroup.value.type === 'url'">
        <mat-form-field>
          <mat-label>Target</mat-label>
          <input type="text" matInput formControlName="target" />
        </mat-form-field>
      </ng-container>

      <ng-container *ngIf="formGroup.value.type === 'route'">
        <mat-form-field>
          <mat-label>Query Params</mat-label>
          <input type="text" matInput formControlName="queryParams" />
        </mat-form-field>
      </ng-container>

      <div>菜单权限</div>
      <div>
        <mat-chip-set>
          <mat-chip
            *ngFor="let userMenu of userMenus"
            (removed)="removeUser(userMenu)"
          >
            {{ userMenu.id.username }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
        </mat-chip-set>

        <mat-chip-set>
          <mat-chip
            *ngFor="let sysroleMenu of sysroleMenus"
            (removed)="removeSysrole(sysroleMenu)"
          >
            {{ sysroleMenu.id.sysroleId }}
            <button matChipRemove>
              <mat-icon>cancel</mat-icon>
            </button>
          </mat-chip>
        </mat-chip-set>
      </div>

      <div>菜单上级：{{ treeNode?.parentName }}</div>
      <spr-sortable-tree
        *ngIf="formGroup.enabled"
        [initSelected]="[treeNode?.parentId]"
        [multiple]="false"
        (onTreeSelect)="onTreeSelect($event)"
      ></spr-sortable-tree>
    </form>
  </mat-card-content>
</mat-card>
